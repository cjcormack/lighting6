//Use common build configuration for modules
apply from: '../../gradle/common/common-module-build.gradle'

// Uncomment if not using Kotlin globally
//apply from: '../../gradle/common/common-kotlin-build.gradle'

// CC Note: Would be nice to be able to put this in 'common-nk-build.gradle', but doing so doesn't appear to work.
buildscript {
	apply from: '../../gradle/common/common-nk-boilerplate.gradle', to: buildscript
}

buildscript {
	dependencies {
		classpath 'com.google.protobuf:protobuf-gradle-plugin:0.8.8'
	}
}

apply plugin: 'com.google.protobuf'

//Additional Compile Dependencies
dependencies {
	compile "io.grpc:grpc-netty-shaded:1.27.2"
	compile "io.grpc:grpc-protobuf:1.27.2"
	compile "io.grpc:grpc-stub:1.27.2"

	compileOnly "javax.annotation:javax.annotation-api:1.2"

	compile group:'urn.org.netkernel', name: 'mod.hds', version: '[0.5.0,)'

	compile("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.3"){
		exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib'
		exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-common'
	}
}

compileKotlin {
    kotlinOptions {
        freeCompilerArgs = ["-XXLanguage:+InlineClasses"]
    }
}

sourceSets["main"].proto.srcDirs("src")

protobuf {
	protoc { artifact = 'com.google.protobuf:protoc:3.11.0' }
	plugins {
		grpc { artifact = "io.grpc:protoc-gen-grpc-java:1.27.2" }
	}
	generateProtoTasks {
		all()*.plugins { grpc {} }
	}
}
